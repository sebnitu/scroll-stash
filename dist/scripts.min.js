!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ScrollStash=e()}(this,(function(){"use strict";function t(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}function e(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function r(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function n(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?r(Object(o),!0).forEach((function(r){e(t,r,o[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var o={autoInit:!1,dataScroll:"scroll-stash",dataAnchor:"scroll-stash-anchor",selectorAnchor:"",selectorAnchorParent:"",selectorTopElem:"",selectorBotElem:"",alignment:"nearest",behavior:"auto",anchorPadding:16,saveKey:"ScrollStash",throttleDelay:100,customEventPrefix:"scroll-stash:"},s=function(t,e,r){var n=r.anchorPadding;if(r.selectorTopElem){var o=t.querySelector(r.selectorTopElem);o&&(n+=o.offsetHeight)}return e.offsetTop-n},a=function(t,e,r){var n=r.anchorPadding;if(r.selectorBotElem){var o=t.querySelector(r.selectorBotElem);o&&(n+=o.offsetHeight)}return e.offsetTop-(t.offsetHeight-(e.offsetHeight+n))},c=function(t,e,r){var n=function(t,e,r){var n=s(t,e,r),o=a(t,e,r);return!(t.scrollTop>n||t.scrollTop<o)}(t,e,r);switch(r.alignment){case"start":return!n&&s(t,e,r);case"center":return!n&&function(t,e,r){var n=s(t,e,r),o=a(t,e,r);return o+(n-o)/2}(t,e,r);case"end":return!n&&a(t,e,r);case"nearest":return function(t,e,r){var n=s(t,e,r),o=a(t,e,r);return t.scrollTop>n?n:t.scrollTop<o&&o}(t,e,r);default:return!1}},i=function(t,e){var r=t.getAttribute("data-".concat(e.dataAnchor));if("false"==r||"ignore"==r)return null;if(r&&t.querySelector(r))return t.querySelector(r);var n=e.selectorAnchor?t.querySelector(e.selectorAnchor):null;if(n&&e.selectorAnchorParent){var o=n.closest(e.selectorAnchorParent);if(o)return o}return n||null},l=function(t,e,r){var n=i(t,r);if(n){var o=c(t,n,r);return o?(e=e||r.behavior,t.scroll({top:o,behavior:e}),t.dispatchEvent(new CustomEvent(r.customEventPrefix+"anchor",{bubbles:!0,detail:{scrolled:{value:o,behavior:e},key:t.getAttribute("data-".concat(r.dataScroll))}})),{scrolled:{value:o,behavior:e},msg:"Anchor was scrolled into view"}):{scrolled:!1,msg:"Anchor is already in view"}}return{scrolled:!1,msg:"Anchor was not found"}},u=function(t){var e={};return document.querySelectorAll("[data-".concat(t.dataScroll,"]")).forEach((function(r){var n=r.getAttribute("data-".concat(t.dataScroll));n&&(e[n]=r.scrollTop)})),localStorage.setItem(t.saveKey,JSON.stringify(e)),document.dispatchEvent(new CustomEvent(t.customEventPrefix+"saved",{bubbles:!0,detail:{state:e}})),e},h=function(t){if(localStorage.getItem(t.saveKey)){var e=JSON.parse(localStorage.getItem(t.saveKey));return Object.keys(e).forEach((function(r){var n=document.querySelector("[data-".concat(t.dataScroll,'="').concat(r,'"]'));n&&(n.scrollTop=e[r])})),document.dispatchEvent(new CustomEvent(t.customEventPrefix+"applied",{bubbles:!0,detail:{state:e}})),e}return{}};return function(){function e(t){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),this.settings=n(n({},o),t),this.state={},this.scrolls=[],this.ticking=!1,this.__handler=this.handler.bind(this),this.settings.autoInit&&this.init()}var r,s,a;return r=e,(s=[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.settings=n(n({},this.settings),e)),this.state=h(this.settings),this.state=Object.keys(this.state).length?this.state:u(this.settings),this.scrolls=document.querySelectorAll("[data-".concat(this.settings.dataScroll,"]")),this.scrolls.forEach((function(e){e.addEventListener("scroll",t.__handler,!1),l(e,!1,t.settings)}))}},{key:"destroy",value:function(){var t=this;this.scrolls.forEach((function(e){e.removeEventListener("scroll",t.__handler,!1)})),this.state={},this.scrolls=[],localStorage.removeItem(this.settings.saveKey)}},{key:"handler",value:function(){var t=this;this.ticking||(this.ticking=!0,setTimeout((function(){t.state=u(t.settings),t.ticking=!1}),this.settings.throttleDelay))}},{key:"anchorGet",value:function(t){return i(t,this.settings)}},{key:"anchorShow",value:function(t,e){return l(t,e,this.settings)}}])&&t(r.prototype,s),a&&t(r,a),e}()}));
