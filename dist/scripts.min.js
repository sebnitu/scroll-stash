!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).ScrollStash=e()}(this,(function(){"use strict";function t(e){return(t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(e)}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function r(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function o(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?r(Object(o),!0).forEach((function(e){n(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}var i="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},a="Expected a function",c=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,u=/^0o[0-7]+$/i,f=parseInt,h="object"==t(i)&&i&&i.Object===Object&&i,d="object"==("undefined"==typeof self?"undefined":t(self))&&self&&self.Object===Object&&self,v=h||d||Function("return this")(),y=Object.prototype.toString,b=Math.max,p=Math.min,g=function(){return v.Date.now()};function m(t,e,n){var r,o,i,c,s,l,u=0,f=!1,h=!1,d=!0;if("function"!=typeof t)throw new TypeError(a);function v(e){var n=r,i=o;return r=o=void 0,u=e,c=t.apply(i,n)}function y(t){return u=t,s=setTimeout(O,e),f?v(t):c}function m(t){var n=t-l;return void 0===l||n>=e||n<0||h&&t-u>=i}function O(){var t=g();if(m(t))return E(t);s=setTimeout(O,function(t){var n=e-(t-l);return h?p(n,i-(t-u)):n}(t))}function E(t){return s=void 0,d&&r?v(t):(r=o=void 0,c)}function j(){var t=g(),n=m(t);if(r=arguments,o=this,l=t,n){if(void 0===s)return y(l);if(h)return s=setTimeout(O,e),v(l)}return void 0===s&&(s=setTimeout(O,e)),c}return e=w(e)||0,S(n)&&(f=!!n.leading,i=(h="maxWait"in n)?b(w(n.maxWait)||0,e):i,d="trailing"in n?!!n.trailing:d),j.cancel=function(){void 0!==s&&clearTimeout(s),u=0,r=l=o=s=void 0},j.flush=function(){return void 0===s?c:E(g())},j}function S(e){var n=t(e);return!!e&&("object"==n||"function"==n)}function O(e){return"symbol"==t(e)||function(e){return!!e&&"object"==t(e)}(e)&&"[object Symbol]"==y.call(e)}function w(t){if("number"==typeof t)return t;if(O(t))return NaN;if(S(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=S(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(c,"");var n=l.test(t);return n||u.test(t)?f(t.slice(2),n?2:8):s.test(t)?NaN:+t}var E=function(t,e,n){var r=!0,o=!0;if("function"!=typeof t)throw new TypeError(a);return S(n)&&(r="leading"in n?!!n.leading:r,o="trailing"in n?!!n.trailing:o),m(t,e,{leading:r,maxWait:e,trailing:o})},j={autoInit:!1,dataScroll:"scroll-stash",dataAnchor:"scroll-stash-anchor",selectorAnchor:"",selectorAnchorParent:"",selectorTopElem:"",selectorBotElem:"",alignment:"nearest",behavior:"auto",anchorPadding:16,saveKey:"ScrollStash",throttleDelay:100,customEventPrefix:"scroll-stash:"},T=function(t,e,n){var r=n.anchorPadding;if(n.selectorTopElem){var o=t.querySelector(n.selectorTopElem);o&&(r+=o.offsetHeight)}return e.offsetTop-r},P=function(t,e,n){var r=n.anchorPadding;if(n.selectorBotElem){var o=t.querySelector(n.selectorBotElem);o&&(r+=o.offsetHeight)}return e.offsetTop-(t.offsetHeight-(e.offsetHeight+r))},A=function(t,e,n){var r=function(t,e,n){var r=T(t,e,n),o=P(t,e,n);return!(t.scrollTop>r||t.scrollTop<o)}(t,e,n);switch(n.alignment){case"start":return!r&&T(t,e,n);case"center":return!r&&function(t,e,n){var r=T(t,e,n),o=P(t,e,n);return o+(r-o)/2}(t,e,n);case"end":return!r&&P(t,e,n);case"nearest":return function(t,e,n){var r=T(t,e,n),o=P(t,e,n);return t.scrollTop>r?r:t.scrollTop<o&&o}(t,e,n);default:return!1}},x=function(t,e){var n=t.getAttribute("data-".concat(e.dataAnchor));if("false"==n||"ignore"==n)return null;if(n&&t.querySelector(n))return t.querySelector(n);var r=e.selectorAnchor?t.querySelector(e.selectorAnchor):null;if(r&&e.selectorAnchorParent){var o=r.closest(e.selectorAnchorParent);if(o)return o}return r||null},k=function(t,e,n){var r=x(t,n);if(r){var o=A(t,r,n);return o?(e=e||n.behavior,t.scroll({top:o,behavior:e}),t.dispatchEvent(new CustomEvent(n.customEventPrefix+"anchor",{bubbles:!0,detail:{scrolled:{value:o,behavior:e},key:t.getAttribute("data-".concat(n.dataScroll))}})),{scrolled:{value:o,behavior:e},msg:"Anchor was scrolled into view"}):{scrolled:!1,msg:"Anchor is already in view"}}return{scrolled:!1,msg:"Anchor was not found"}},q=function(t){var e={};return document.querySelectorAll("[data-".concat(t.dataScroll,"]")).forEach((function(n){var r=n.getAttribute("data-".concat(t.dataScroll));r&&(e[r]=n.scrollTop)})),localStorage.setItem(t.saveKey,JSON.stringify(e)),document.dispatchEvent(new CustomEvent(t.customEventPrefix+"saved",{bubbles:!0,detail:{state:e}})),e},D=function(t){if(localStorage.getItem(t.saveKey)){var e=JSON.parse(localStorage.getItem(t.saveKey));return Object.keys(e).forEach((function(n){var r=document.querySelector("[data-".concat(t.dataScroll,'="').concat(n,'"]'));r&&(r.scrollTop=e[n])})),document.dispatchEvent(new CustomEvent(t.customEventPrefix+"applied",{bubbles:!0,detail:{state:e}})),e}return{}};return function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.settings=o(o({},j),e),this.state={},this.scrolls=[],this.throttleRef=E(this.handler,this.settings.throttleDelay,{leading:!1}).bind(this),this.settings.autoInit&&this.init()}var n,r,i;return n=t,(r=[{key:"init",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;e&&(this.settings=o(o({},this.settings),e)),this.state=D(this.settings),this.state=Object.keys(this.state).length?this.state:q(this.settings),this.scrolls=document.querySelectorAll("[data-".concat(this.settings.dataScroll,"]")),this.scrolls.forEach((function(e){e.addEventListener("scroll",t.throttleRef),k(e,!1,t.settings)}))}},{key:"destroy",value:function(){var t=this;this.scrolls.forEach((function(e){e.removeEventListener("scroll",t.throttleRef)})),this.state={},this.scrolls=[],localStorage.removeItem(this.settings.saveKey)}},{key:"handler",value:function(){this.state=q(this.settings)}},{key:"anchorGet",value:function(t){return x(t,this.settings)}},{key:"anchorShow",value:function(t,e){return k(t,e,this.settings)}}])&&e(n.prototype,r),i&&e(n,i),t}()}));
